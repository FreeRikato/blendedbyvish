# Bug Hunter & Conversion Optimization Plan

## Summary

Final "Severity 1" code review for a Makeup Artist portfolio website (Vite + TypeScript + fluid CSS).  
Focus areas: Safari/iOS edge cases, broken image handling, and TypeScript null safety.

> **Skipped Features:** Portfolio filtering, Web3Forms contact form (per user request)

---

## Phase 1: Safari/iOS Stress Test Fixes

### 1.1 Overscroll Behavior on Testimonials Carousel

**Problem:** Horizontal swipe in `.testimonial-track` can trigger Safari's browser back/forward navigation gesture.

**File:** `src/style.css` (lines ~1264-1274)

**Fix:** Add `overscroll-behavior-x: contain` to prevent gesture interference:

```css
.testimonial-track {
    /* existing properties... */
    overscroll-behavior-x: contain;
}
```

### 1.2 100dvh Fallback for Landscape Mode

**Problem:** Landscape nav-menu uses only `100dvh` without fallback for older iOS Safari (pre-15.4).

**File:** `src/style.css` (lines ~877-885)

**Fix:** Add `100vh` fallback before `100dvh`:

```css
@media (max-width: 1024px) and (orientation: landscape) {
    .nav-menu {
        height: 100vh;   /* Fallback for older Safari */
        height: 100dvh;  /* Modern browsers override */
        /* rest unchanged */
    }
}
```

---

## Phase 2: Broken Image Fallback Handler

**Problem:** Images that fail to load show broken icons or collapse layout. Current `onerror` handler only applies when lightbox opens, not on initial page load.

**File:** `src/main.ts`

### Solution

Create a reusable image error handler and apply it to all portfolio images on page load.

```typescript
// Add near top of file
const FALLBACK_GRADIENT = 'linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%)';
const FALLBACK_SVG = `data:image/svg+xml;base64,${btoa(`
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
    <rect fill="#2d2d2d" width="100" height="100"/>
    <text x="50" y="50" text-anchor="middle" dy=".35em" 
          fill="#666" font-family="sans-serif" font-size="8">
      Image unavailable
    </text>
  </svg>
`)}`;

function handleImageError(img: HTMLImageElement): void {
    img.style.background = FALLBACK_GRADIENT;
    img.src = FALLBACK_SVG;
    img.alt = 'Image unavailable';
}

// Apply to all portfolio images on load
function initImageErrorHandlers(): void {
    const images = document.querySelectorAll('.portfolio-img');
    images.forEach((img) => {
        if (img instanceof HTMLImageElement && !img.complete) {
            img.onerror = () => handleImageError(img);
        } else if (img instanceof HTMLImageElement && img.naturalWidth === 0) {
            // Already failed to load
            handleImageError(img);
        }
    });
}
```

**Integration:** Call `initImageErrorHandlers()` in `initAllFeatures()` (line ~941).

---

## Phase 3: TypeScript Null Safety Fixes

**Problem:** Multiple unsafe `as HTMLElement` casts that could crash if IDs are renamed/missing.

### 3.1 High-Priority Fixes

| Location | Issue | Fix |
|----------|-------|-----|
| `main.ts:309` | Lightbox cast without null check | Add `if (!lightbox) return;` guard |
| `main.ts:358` | `imgElement.src` access without null check | Add `if (!imgElement) continue;` |
| `main.ts:489` | Comparison slider handle cast | Add `instanceof HTMLElement` check |
| `main.ts:967-971` | Form elements accessed before null check | Reorder: null check BEFORE property access |

### 3.2 Recommended Pattern

Replace unsafe casts with `instanceof` guards:

```typescript
// BEFORE (unsafe)
const lightbox = document.getElementById('lightbox') as HTMLElement;
const lightboxClose = lightbox?.querySelector('.lightbox-close') as HTMLButtonElement;

// AFTER (safe)
const lightbox = document.getElementById('lightbox');
if (!(lightbox instanceof HTMLElement)) {
    console.warn('Lightbox element not found');
    return;
}
const lightboxClose = lightbox.querySelector('.lightbox-close');
if (!(lightboxClose instanceof HTMLButtonElement)) return;
```

### 3.3 Files to Modify

- `src/main.ts` - Lines 309-314, 358, 489, 967-980

---

## Implementation Checklist

- [ ] **CSS Fix 1:** Add `overscroll-behavior-x: contain` to `.testimonial-track`
- [ ] **CSS Fix 2:** Add `100vh` fallback for landscape nav-menu
- [ ] **TS Fix 1:** Create `handleImageError()` utility function
- [ ] **TS Fix 2:** Create `initImageErrorHandlers()` and add to init chain
- [ ] **TS Fix 3:** Add null guards to lightbox initialization (lines 309-314)
- [ ] **TS Fix 4:** Add null guard to portfolio image access (line 358)
- [ ] **TS Fix 5:** Add null guard to comparison slider handle (line 489)
- [ ] **TS Fix 6:** Fix form element access order (lines 967-980)

---

## Verification

1. **Build Check:**
   ```bash
   npm run build
   ```
   Should complete with no TypeScript errors.

2. **Dev Server Test:**
   ```bash
   npm run dev
   ```
   - Open in Safari iOS simulator or real device
   - Test testimonials carousel swipe (should NOT trigger back navigation)
   - Test mobile menu in landscape orientation
   - Temporarily break an image path to verify fallback displays

3. **Console Check:**
   - No `TypeError: Cannot read properties of null` errors
   - No `Uncaught` exceptions during navigation

---

## Files to Modify

| File | Changes |
|------|---------|
| `src/style.css` | 2 edits (overscroll, landscape fallback) |
| `src/main.ts` | ~6 edits (image handler, null guards) |
